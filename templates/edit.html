{{define "editgp"}}
<html lang="uk-UA">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Title</title>
    <script src="/assets/jquery-3.6.0.min.js"></script>
    <link href="/assets/bootstrap/css/bootstrap.css" rel="stylesheet">
    <script src="/assets/bootstrap/js/bootstrap.bundle.min.js"></script>
    <link href="/assets/fontawesome/css/all.css" rel="stylesheet">
    <link href="/assets/gpo.css" rel="stylesheet">
    <script src="/assets/scripts.js"></script>
    <style>
        .breadcrumb-item.active {
            color: #000000;
        }
        body {
            background-color: #edeeef;
        }
        .btn-link {
            color: #000000;
        }
    </style>
</head>
<body class="container">
<nav style="--bs-breadcrumb-divider: '>'; background-color: #75AF26;" aria-label="breadcrumb" class="align-self-center d-flex p-2">
    <ol class="breadcrumb col-11 navbar-brand">
        <li class="breadcrumb-item" style="padding-left: 0rem;"><a href="/" class="navbar-brand"><i class="fas fa-users"></i></a></li>
        <li class="breadcrumb-item active" style="padding-left: 0rem;" id="gpname" aria-current="page">{{.Gpname}}</li>
    </ol>
    <div class="dropdown col-1">
        <button class="btn btn-link" type="button" id="dropdownMenuButton1" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-ellipsis-v"></i>
        </button>
        <ul class="dropdown-menu dropdown-menu-dark" aria-labelledby="dropdownMenuButton1">
            <li><a href="/add?name={{.Gpname}}" class="dropdown-item">Додати правило(а)</a></li>
            <li><button type="button" class="dropdown-item modal1" data-bs-toggle="modal" data-bs-target="#exampleModal">
                Редагувати політику
            </button></li>
        </ul>
    </div>
</nav>
<div class="d-flex align-items-start">
    <div class="col-3" style="overflow-y: auto; height: 85vh;">
    <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
        <input class="form-control fas fa-search" id="mySearch" type="text" placeholder="&#xF002;">
    {{range .Rules}}
        <button class="nav-link text-start" id="v-pills-{{.ID}}-tab" data-bs-toggle="pill" data-bs-target="#v-pills-{{.ID}}" type="button" role="tab" aria-controls="v-pills-{{.ID}}" aria-selected="true">
        {{.DisplayName}}</button>
        <script>
            var gpname = document.getElementById("gpname").innerText;
            var rulegpname = "{{.GpName}}";
            var lnk = document.getElementById("v-pills-{{.ID}}-tab");
            if (gpname != rulegpname) {
                lnk.style = "color: #000000;";
                lnk.innerText += " (" + rulegpname + ")";
            }
        </script>
    {{end}}
        <script>
            $(document).ready(function(){
                $("#mySearch").on("keyup", function() {
                    var value = $(this).val().toLowerCase();
                    $("#v-pills-tab button").filter(function() {
                        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
                    });
                });
            });
        </script>
    </div>
</div>
    <div class="tab-content container-sm" id="v-pills-tabContent">
    {{range .Rules}}
        <div class="tab-pane fade show" id="v-pills-{{.ID}}" role="tabpanel" aria-labelledby="v-pills-{{.ID}}-tab">
        <p><h2>{{.DisplayName}}</h2></p>
        <p>Клас: {{.Class}}</p>
        <p>Розділ: {{.Category}}</p>
        <p>Підтримує: {{.SupportedOn}}</p>
        <p>
        <button class="btn btn-light" type="button" data-bs-toggle="collapse" data-bs-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
            Опис
        </button>
        </p>
        <div class="collapse" id="collapseExample">
            <div class="card card-body">
                {{.ExplainText}}
            </div>
        </div>
    <form method="POST" id="update-form-{{.ID}}" >
        <div id="gprules" >
            {{if .HasManual}}
            <div class="row manualValues" id="hasmanual-{{.ID}}">
            {{range .Values}}
            {{if ne .DisabledValue ""}}
            <input hidden id="selvalue-ENDI-{{.ValueName}}-{{.ParentID}}" value="{{.SelectedValue}}">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="{{.ValueName}}" value="{{.EnabledValue}}" id="enabled-{{.ValueName}}-{{.ParentID}}">
                <label class="form-check-label" for="enabled-{{.ValueName}}-{{.ParentID}}">
                    Enabled
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="{{.ValueName}}" value="{{.DisabledValue}}" id="disabled-{{.ValueName}}-{{.ParentID}}">
                <label class="form-check-label" for="disabled-{{.ValueName}}-{{.ParentID}}">
                    Disabled
                </label>
            </div>
            <script>
                var sel = document.getElementById("selvalue-ENDI-{{.ValueName}}-{{.ParentID}}").value;
                var en = document.getElementById("enabled-{{.ValueName}}-{{.ParentID}}");
                var di = document.getElementById("disabled-{{.ValueName}}-{{.ParentID}}");
                if (sel === en.value) {
                    en.checked = true;
                    di.checked = false;
                }
                if (sel === di.value) {
                    di.checked = true;
                    en.checked = false;
                }
            </script>
            {{end}}
            {{if ne .TrueValue ""}}
            <input hidden id="selvalue-TRFL-{{.ValueName}}-{{.ParentID}}" value="{{.SelectedValue}}">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="{{.ValueName}}" value="{{.TrueValue}}" id="true-{{.ValueName}}-{{.ParentID}}">
                <label class="form-check-label" for="true-{{.ValueName}}-{{.ParentID}}">
                    True
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="{{.ValueName}}" value="{{.FalseValue}}" id="false-{{.ValueName}}-{{.ParentID}}">
                <label class="form-check-label" for="false-{{.ValueName}}-{{.ParentID}}">
                    False
                </label>
            </div>
            <script>
                var sel = document.getElementById("selvalue-TRFL-{{.ValueName}}-{{.ParentID}}").value;
                var en = document.getElementById("true-{{.ValueName}}-{{.ParentID}}");
                var di = document.getElementById("false-{{.ValueName}}-{{.ParentID}}");
                if (sel === en.value) {
                    en.checked = true;
                    di.checked = false;
                }
                if (sel === di.value) {
                    di.checked = true;
                    en.checked = false;
                }
            </script>
            {{end}}
            {{if .Dublicate}}
            <input hidden id="dublval-{{.ValueName}}-{{.ParentID}}" value="{{.Value}}">
            <input hidden id="dubldn-{{.ValueName}}-{{.ParentID}}" value="{{.DisplayName}}">
            <input hidden id="dublsel-{{.ValueName}}-{{.ParentID}}" value="{{.SelectedValue}}">
            <div class="col-5">
                <select id="gpvalues-{{.ValueName}}-{{.ParentID}}" name="{{.ValueName}}" class="form-select" aria-label="Default select example">
                    <option value="" disabled="" selected="">Виберіть значення</option>
                </select>
            </div>
            <!--    <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="Check-{{.ParentID}}">
                    <label class="form-check-label" for="Check-{{.ParentID}}">
                        видалити значення?
                    </label>
                </div> -->
            <script>
                $(document).ready(function() {
                    //var delVal = $("#Check-{{.ParentID}}");
                    var vals = $("#dublval-{{.ValueName}}-{{.ParentID}}").val().split("|");
                    var dnames = $("#dubldn-{{.ValueName}}-{{.ParentID}}").val().split("|");
                    var selval = $("#dublsel-{{.ValueName}}-{{.ParentID}}").val();
                    //if (delVal.checked == true) {
                    //    $("#gpvalues-{{.ValueName}}-{{.ParentID}}").prop("disabled",true);
                    //$("#gpvalues-{{.ValueName}}-{{.ParentID}}").value = "DELETE";
                    //}
                    for (let [i, val] of vals.entries()) {
                        if (val === "") {
                            val = dnames[i];
                        }
                        $("#gpvalues-{{.ValueName}}-{{.ParentID}}").append(new Option(dnames[i], val));
                        if (val === selval) {
                            $("#gpvalues-{{.ValueName}}-{{.ParentID}} option[value="+val+"]").prop("selected",true);
                        }

                    }
                })
            </script>
            {{ else }}
            {{if .Manual}}
                <div class="col-sm-4"><input type="text" name="manualValueName" aria-label="ValueName" class="form-control" id="manualvn_text-0" inputmode="text" placeholder="ім'я значення" value="{{.ValueName}}"></div>
                <div class="col-sm-4"><input type="text" name="manualValue" aria-label="Value" class="form-control" id="manualv_text-0" inputmode="text" placeholder="значення" value="{{.SelectedValue}}" ></div>
                <div class="col-sm-3"><input type="text" name="manualDescription" aria-label="Info" class="form-control" id="manuali_text-0" inputmode="text" placeholder="опис" value="{{.Notes}}" ></div>
            {{else}}
                <p></p>
            <div class="col-5">
                {{if eq .Type "REG_SZ"}}
                <input type="text" class="form-control" id="{{.ValueName}}_text-{{.ParentID}}" name="{{.ValueName}}" inputmode="text" placeholder="{{.ValueName}}" value="{{.SelectedValue}}">
                {{end}}
                {{if and (eq .Type "REG_DWORD") (eq .DisabledValue "") (eq .TrueValue "")}}
                <input type="text" class="form-control" id="{{.ValueName}}_number-{{.ParentID}}" name="{{.ValueName}}" inputmode="numeric" placeholder="{{.ValueName}}" value="{{.SelectedValue}}">
                {{end}}
                {{if eq .Type "REG_MULTISZ"}}
                <textarea rows = "5" cols = "60" class="form-control" name="{{.ValueName}}" id="{{.ValueName}}_multiline-{{.ParentID}}" placeholder="{{.ValueName}}">
                            {{.SelectedValue}}
                        </textarea>
                {{end}}
                {{if eq .Type "REG_QWORD"}}
                <input type="number" class="form-control" id="{{.ValueName}}_bin-{{.ParentID}}" name="{{.ValueName}}" inputmode="text" placeholder="{{.ValueName}}" value="{{.SelectedValue}}">
                {{end}}
            </div>
            {{end}}
            {{end}}
            {{end}}
            </div>
            <div id="manBtn-{{.ID}}" class="col-sm-1"><button type="button" class="btn btn-primary add-new" onclick="funcAddManual(this,{{.ID}})"><i class="fa fa-plus"></i></button></div>
            {{else}}
            {{range .Values}}
            {{if ne .DisabledValue ""}}
            <input hidden id="selvalue-ENDI-{{.ValueName}}-{{.ParentID}}" value="{{.SelectedValue}}">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="{{.ValueName}}" value="{{.EnabledValue}}" id="enabled-{{.ValueName}}-{{.ParentID}}">
                <label class="form-check-label" for="enabled-{{.ValueName}}-{{.ParentID}}">
                    Enabled
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="{{.ValueName}}" value="{{.DisabledValue}}" id="disabled-{{.ValueName}}-{{.ParentID}}">
                <label class="form-check-label" for="disabled-{{.ValueName}}-{{.ParentID}}">
                    Disabled
                </label>
            </div>
            <script>
                var sel = document.getElementById("selvalue-ENDI-{{.ValueName}}-{{.ParentID}}").value;
                var en = document.getElementById("enabled-{{.ValueName}}-{{.ParentID}}");
                var di = document.getElementById("disabled-{{.ValueName}}-{{.ParentID}}");
                if (sel === en.value) {
                    en.checked = true;
                    di.checked = false;
                }
                if (sel === di.value) {
                    di.checked = true;
                    en.checked = false;
                }
            </script>
            {{end}}
            {{if ne .TrueValue ""}}
            <input hidden id="selvalue-TRFL-{{.ValueName}}-{{.ParentID}}" value="{{.SelectedValue}}">
            <div class="form-check">
                <input class="form-check-input" type="radio" name="{{.ValueName}}" value="{{.TrueValue}}" id="true-{{.ValueName}}-{{.ParentID}}">
                <label class="form-check-label" for="true-{{.ValueName}}-{{.ParentID}}">
                    True
                </label>
            </div>
            <div class="form-check">
                <input class="form-check-input" type="radio" name="{{.ValueName}}" value="{{.FalseValue}}" id="false-{{.ValueName}}-{{.ParentID}}">
                <label class="form-check-label" for="false-{{.ValueName}}-{{.ParentID}}">
                    False
                </label>
            </div>
            <script>
                var sel = document.getElementById("selvalue-TRFL-{{.ValueName}}-{{.ParentID}}").value;
                var en = document.getElementById("true-{{.ValueName}}-{{.ParentID}}");
                var di = document.getElementById("false-{{.ValueName}}-{{.ParentID}}");
                if (sel === en.value) {
                    en.checked = true;
                    di.checked = false;
                }
                if (sel === di.value) {
                    di.checked = true;
                    en.checked = false;
                }
            </script>
            {{end}}
            {{if .Dublicate}}
            <input hidden id="dublval-{{.ValueName}}-{{.ParentID}}" value="{{.Value}}">
            <input hidden id="dubldn-{{.ValueName}}-{{.ParentID}}" value="{{.DisplayName}}">
            <input hidden id="dublsel-{{.ValueName}}-{{.ParentID}}" value="{{.SelectedValue}}">
            <div class="col-5">
                <select id="gpvalues-{{.ValueName}}-{{.ParentID}}" name="{{.ValueName}}" class="form-select" aria-label="Default select example">
                    <option value="" disabled="" selected="">Виберіть значення</option>
                </select>
            </div>
            <!--    <div class="form-check">
                    <input class="form-check-input" type="checkbox" id="Check-{{.ParentID}}">
                    <label class="form-check-label" for="Check-{{.ParentID}}">
                        видалити значення?
                    </label>
                </div> -->
            <script>
                $(document).ready(function() {
                    //var delVal = $("#Check-{{.ParentID}}");
                    var vals = $("#dublval-{{.ValueName}}-{{.ParentID}}").val().split("|");
                    var dnames = $("#dubldn-{{.ValueName}}-{{.ParentID}}").val().split("|");
                    var selval = $("#dublsel-{{.ValueName}}-{{.ParentID}}").val();
                    //if (delVal.checked == true) {
                    //    $("#gpvalues-{{.ValueName}}-{{.ParentID}}").prop("disabled",true);
                    //$("#gpvalues-{{.ValueName}}-{{.ParentID}}").value = "DELETE";
                    //}
                    for (let [i, val] of vals.entries()) {
                        if (val === "") {
                            val = dnames[i];
                        }
                        $("#gpvalues-{{.ValueName}}-{{.ParentID}}").append(new Option(dnames[i], val));
                        if (val === selval) {
                            $("#gpvalues-{{.ValueName}}-{{.ParentID}} option[value="+val+"]").prop("selected",true);
                        }

                    }
                })
            </script>
            {{ else }}
            <p id="dname">{{.DisplayName}}</p>
            <div class="col-5">
                {{if eq .Type "REG_SZ"}}
                <input type="text" class="form-control" id="{{.ValueName}}_text-{{.ParentID}}" name="{{.ValueName}}" inputmode="text" placeholder="{{.ValueName}}" value="{{.SelectedValue}}">
                {{end}}
                {{if and (eq .Type "REG_DWORD") (eq .DisabledValue "") (eq .TrueValue "")}}
                <input type="text" class="form-control" id="{{.ValueName}}_number-{{.ParentID}}" name="{{.ValueName}}" inputmode="numeric" placeholder="{{.ValueName}}" value="{{.SelectedValue}}">
                {{end}}
                {{if eq .Type "REG_MULTISZ"}}
                <textarea rows = "5" cols = "60" class="form-control" name="{{.ValueName}}" id="{{.ValueName}}_multiline-{{.ParentID}}" placeholder="{{.ValueName}}">
                            {{.SelectedValue}}
                        </textarea>
                {{end}}
                {{if eq .Type "REG_QWORD"}}
                <input type="number" class="form-control" id="{{.ValueName}}_bin-{{.ParentID}}" name="{{.ValueName}}" inputmode="text" placeholder="{{.ValueName}}" value="{{.SelectedValue}}">
                {{end}}
            </div>
            {{end}}
            <p></p>
            {{end}}
            {{end}}

        </div>
        <p>
        <hr>
<!--        <div class="form-check">
            <input class="form-check-input" type="checkbox" value="DELETE" id="flexCheckAll-{{.ID}}">
            <label class="form-check-label" for="flexCheckAll-{{.ID}}">
                видалити значення?
            </label>
        </div> -->
        </p>
        <p>
            <input id="savebtn-{{.ID}}" class="btn btn-success fas fa-save" type="button" value="&#xf0c7" onclick="funcSaveRule({{.ID}})">
            <a class="btn btn-primary" id="copybtn-{{.ID}}" href=""><i class="fas fa-copy"></i></a>
            <a class="btn btn-danger" id="deletebtn-{{.ID}}" href="/deleterule?id={{.ID}}"><i class="fas fa-trash"></i></a>
            <p id="res-{{.ID}}"></p>
            <script>
//                var delAll = document.getElementById("flexCheckAll-{{.ID}}")
                var gpname = document.getElementById("gpname").innerText;
                var cp = document.getElementById("copybtn-{{.ID}}");
                var rulegpname = "{{.GpName}}";
                //var lnk = document.getElementById("v-pills-{{.ID}}");
                cp.href = "/copy?id={{.ID}}&gpname="+gpname;
                if (gpname !== rulegpname) {
                    document.getElementById("deletebtn-{{.ID}}").hidden = true;
                    document.getElementById("savebtn-{{.ID}}").hidden = true;
                    $("#v-pills-{{.ID}} :input").prop("disabled", true);
                }
            </script>
        </p>
        </div>
    </form>
        <p id="out"></p>
    {{end}}
    </div>
    </div>


<!-- Modal -->
<div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
        </div>
    </div>
</div>

<script>
    $('.modal1').on('click',function(){
        $('.modal-content').load('/showeditgp?name={{.Gpname}}',function(){
            $('#exampleModal').modal({show:true});
        });
    });
    /*
    function showValues() {
        var str = $("form").serialize();
        $("#out").text( str );
    }
    $("input[type='checkbox'], input[type='radio']").on( "click", showValues );
    $("select").on( "change", showValues );
    showValues();
     */
    var manual = document.getElementsByClassName("manualValues");
    console.log(manual);
</script>

</body>
</html>

{{end}}